@model AllViewModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
<head>

    <link rel="stylesheet" type="text/css" href="~/app-assets/css/vendors.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/vendors/css/extensions/toastr.css">
    <!-- END VENDOR CSS-->
    <!-- BEGIN STACK CSS-->
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/app.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/custom.css">
    <!-- END STACK CSS-->
    <!-- BEGIN Page Level CSS-->
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/core/menu/menu-types/vertical-menu.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/core/colors/palette-gradient.css">
    <link rel="stylesheet" type="text/css" href="~/app-assets/css/pages/login-register.css">
    <!-- END Page Level CSS-->
    <link rel="stylesheet" type="text/css" href="~/app-assets/css-rtl/plugins/extensions/toastr.css">
    <!-- BEGIN Custom CSS-->
    <link rel="stylesheet" type="text/css" href="~/assets/css/style.css">
    <!-- END Custom CSS-->
    <style>
        body {
            font-family: Arial, Georgia, 'Times New Roman', Times, serif;
        }

        .toast-success {
            margin-top: 5px;
        }

        span {
            font-size: 18px;
        }

        input {
            font-size: 20px;
        }

        .btn {
            font-size: 18px;
        }

        label {
            font-size: 20px;
        }

        .text-danger {
            font-size: 18px;
        }

        .card {
            box-shadow: 0em -1.2em 1.2em rgba(255, 255, 255, 0.06), 0em 1.2em 1.2em rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="vertical-layout vertical-menu 1-column  mt-5  menu-expanded blank-page blank-page"
      data-open="click" data-menu="vertical-menu" data-col="1-column">

    <div class="" style="background-color:aliceblue">
        <div class=" col-md-6 offset-md-3 round">
            <h2 class="text-center alert " style="background-color:#ffffff;">Forgot password form</h2>

        </div>
        <hr />

        <div class="container-fluid" id="emailDiv">
            <div class="col-md-8 offset-md-2">

                <div class="card round">
                    <div class="card-body">
                        <div class=" text-center" id="load" style="display:none">
                            <img src="~/images/StaticImages/giphy (1).gif" style="margin:0px;position:relative;" />
                        </div>
                        <div class="row" style="justify-content:center">
                            <div class="col-md-4">
                                <form asp-action="ForgotPassword" data-ajax-loading="#load" data-ajax="true" data-ajax-method="post" data-ajax-success="fnEmailFind(data)">
                                    @*<div asp-validation-summary="All" class="text-danger"></div>*@
                                    <div class="form-group">
                                        <label asp-for="forgot.Email"></label>
                                        <input asp-for="forgot.Email" class="form-control round border" />
                                        <span asp-validation-for="forgot.Email" class="text-danger"></span>
                                    </div>
                                    <button type="submit" id="btnSubmit" class="btn btn-primary round">Submit </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="container-fluid" id="codeDiv" style="display:none">
            <div class="col-md-8 offset-md-2">
                <div class="card round">
                    <div class="card-body">
                        <div class="text-center " style="color:dodgerblue">
                            <h2>Code sent !</h2>
                            <h3>A six digit code sent to your email please enter the code here.</h3>
                        </div>
                        <hr /><br />
                        <div class="row" style="justify-content:center">
                            <div class="col-md-4">

                                @*<div asp-validation-summary="All" class="text-danger"></div>*@
                                <div class="form-group">
                                    @*<label asp-for="code.Code"></label>*@
                                    <input asp-for="code.Code" class="form-control round border" />
                                    <span asp-validation-for="code.Code" id="CodeError" class="text-danger"></span>
                                </div>
                                <button type="button" id="btnCode" class="btn btn-primary round">Submit </button>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid" id="newPasswordDiv" style="display:none">
            <div class="col-md-8 offset-md-2">
                <div class="card round">
                    <div class="card-body">
                        <div class="text-center">
                            <h2>Enter new password</h2>
                        </div>
                        <div class="row" style="justify-content:center">
                            <div class="col-md-4">
                                <form asp-action="AddNewPassword" data-ajax="true" data-ajax-method="post" data-ajax-success="fnNewPassword(data)">
                                    <div asp-validation-summary="All" class="text-danger"></div>
                                    <input hidden asp-for="reset.userEmail" />

                                    <div class="form-group">
                                        <label asp-for="reset.NewPassword"></label>
                                        <div class="input-group">

                                            <input asp-for="reset.NewPassword" class="form-control" placeholder="New password" aria-describedby="basic-addon4">
                                            <div class="input-group-append">
                                                <span class="input-group-text" id="firstPass" style="cursor:pointer"><i class="ft-eye"></i></span>
                                            </div>
                                        </div>
                                        <span asp-validation-for="reset.NewPassword" class="text-danger"></span>
                                    </div>

                                    <div class="form-group">
                                        <label asp-for="reset.ConfirmPassword"></label>
                                        <div class="input-group">

                                            <input asp-for="reset.ConfirmPassword" class="form-control" placeholder="Confirm new password" aria-describedby="basic-addon4">
                                            <div class="input-group-append">
                                                <span class="input-group-text" id="secondPass" style="cursor:pointer"><i class="ft-eye"></i></span>
                                            </div>
                                        </div>
                                        <span asp-validation-for="reset.ConfirmPassword" class="text-danger"></span>
                                    </div>

                                    <button type="submit" class="btn btn-primary round">Submit </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center ">
            <a asp-action="Login" asp-controller="Account" style="font-size:20px;" class="link round"> Back to login page <span class="ft-chevrons-right"></span></a>
        </div>

    </div>

</body>
</html>

<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
<script src="~/lib/Unobtrusive ajax/jquery.unobtrusive-ajax.js"></script>
<script src="~/app-assets/vendors/js/extensions/toastr.min.js" type="text/javascript"></script>

<script src="~/app-assets/js/scripts/extensions/toastr.js" type="text/javascript"></script>
<script>
    var pass1 = true;
    var pass2 = true;
    $("#firstPass").click(function () {
        if (pass1) {
            $("#reset_NewPassword").attr("type", "text");
            pass1 = false
        } else {
            $("#reset_NewPassword").attr("type", "password");
            pass1 = true
        }
    })
    $("#secondPass").click(function () {
        if (pass2) {
            $("#reset_ConfirmPassword").attr("type", "text");
            pass2 = false
        } else {
            $("#reset_ConfirmPassword").attr("type", "password");
            pass2 = true
        }
    })

</script>
<script>
    var code = 0;

    function fnEmailFind(data) {
        code = data;

        if (data == 3) {
            toastr.error("  Code not sent please check your computer or mobile is connected to internet.", '', { "progressBar": true, positionClass: 'toast-top-right', containerId: 'toast-top-right' });
           
        } else if (data == 1) {
            toastr.error("User not found please check your email and try again.", '', { "progressBar": true, positionClass: 'toast-top-right', containerId: 'toast-top-right' });
           
        }
        else if (data == 2) {
            toastr.error("Your account has been blocked by Dean you can't change your password right now.", '', { "progressBar": true, positionClass: 'toast-top-right', containerId: 'toast-top-right' });
         
        }
        else {
           
            $("#codeDiv").show();
            $("#emailDiv").hide();
        }
    }

    function fnNewPassword(data) {
        if (data == "done") {

            toastr.success("Your password changed successfully now you can login by new password.", '', { "progressBar": true, positionClass: 'toast-top-right', containerId: 'toast-top-right' });
            location.href = "/Home/Index";
        } else {
            toastr.error(data, '', { "progressBar": true, positionClass: 'toast-top-right', containerId: 'toast-top-right' });
        }
    }

    $("#btnCode").click(function () {


        if ($("#code_Code").val() == code) {
            $("#newPasswordDiv").show();
            $("#codeDiv").hide();
            $("#reset_userEmail").val($("#forgot_Email").val());
        } else {
            if ($("#code_Code").val() == "") {
                $("#CodeError").text("Please enter the code !");
            } else {
                $("#CodeError").text("Code is incorrect !");
            }
        }

    })

</script>
